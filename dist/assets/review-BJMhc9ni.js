import{c as ye,g as Ce,u as De,R as B,j as n,L as Ne}from"./index-fFMlRtGA.js";import{u as ke}from"./useDataStore-BvNNDx_L.js";import{C as we}from"./cloud-upload-DsKbm9n5.js";import{R as Ae}from"./refresh-cw-Ddrz7zs_.js";/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Oe=ye("circle-check",Ie);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]],Le=ye("list-checks",Fe);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Te=ye("map-pin",Me);/**
 * @license lucide-react v0.541.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Ue=ye("save",ze);var ge={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var qe=ge.exports,je;function He(){return je||(je=1,(function(O,V){((z,v)=>{O.exports=v()})(qe,function z(){var v=typeof self<"u"?self:typeof window<"u"?window:v!==void 0?v:{},H,$=!v.document&&!!v.postMessage,X=v.IS_PAPA_WORKER||!1,W={},_e=0,h={};function Q(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var s=ce(t);s.chunkSize=parseInt(s.chunkSize),t.step||t.chunk||(s.chunkSize=null),this._handle=new le(s),(this._handle.streamer=this)._config=s}).call(this,e),this.parseChunk=function(t,s){var o=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<o){let g=this._config.newline;g||(a=this._config.quoteChar||'"',g=this._handle.guessLineEndings(t,a)),t=[...t.split(g).slice(o)].join(g)}this.isFirstChunk&&b(this._config.beforeFirstChunk)&&(a=this._config.beforeFirstChunk(t))!==void 0&&(t=a),this.isFirstChunk=!1,this._halted=!1;var o=this._partialLine+t,a=(this._partialLine="",this._handle.parse(o,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=a.meta.cursor,o=(this._finished||(this._partialLine=o.substring(t-this._baseIndex),this._baseIndex=t),a&&a.data&&(this._rowCount+=a.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),X)v.postMessage({results:a,workerId:h.WORKER_ID,finished:o});else if(b(this._config.chunk)&&!s){if(this._config.chunk(a,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=a=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(a.data),this._completeResults.errors=this._completeResults.errors.concat(a.errors),this._completeResults.meta=a.meta),this._completed||!o||!b(this._config.complete)||a&&a.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),o||a&&a.meta.paused||this._nextChunk(),a}this._halted=!0},this._sendError=function(t){b(this._config.error)?this._config.error(t):X&&this._config.error&&v.postMessage({workerId:h.WORKER_ID,error:t,finished:!1})}}function ne(e){var t;(e=e||{}).chunkSize||(e.chunkSize=h.RemoteChunkSize),Q.call(this,e),this._nextChunk=$?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(s){this._input=s,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),$||(t.onload=q(this._chunkLoaded,this),t.onerror=q(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!$),this._config.downloadRequestHeaders){var s,o=this._config.downloadRequestHeaders;for(s in o)t.setRequestHeader(s,o[s])}var a;this._config.chunkSize&&(a=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+a));try{t.send(this._config.downloadRequestBody)}catch(g){this._chunkError(g.message)}$&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(s=>(s=s.getResponseHeader("Content-Range"))!==null?parseInt(s.substring(s.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(s){s=t.statusText||s,this._sendError(new Error(s))}}function ae(e){(e=e||{}).chunkSize||(e.chunkSize=h.LocalChunkSize),Q.call(this,e);var t,s,o=typeof FileReader<"u";this.stream=function(a){this._input=a,s=a.slice||a.webkitSlice||a.mozSlice,o?((t=new FileReader).onload=q(this._chunkLoaded,this),t.onerror=q(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var a=this._input,g=(this._config.chunkSize&&(g=Math.min(this._start+this._config.chunkSize,this._input.size),a=s.call(a,this._start,g)),t.readAsText(a,this._config.encoding));o||this._chunkLoaded({target:{result:g}})},this._chunkLoaded=function(a){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(a.target.result)},this._chunkError=function(){this._sendError(t.error)}}function te(e){var t;Q.call(this,e=e||{}),this.stream=function(s){return t=s,this._nextChunk()},this._nextChunk=function(){var s,o;if(!this._finished)return s=this._config.chunkSize,t=s?(o=t.substring(0,s),t.substring(s)):(o=t,""),this._finished=!t,this.parseChunk(o)}}function oe(e){Q.call(this,e=e||{});var t=[],s=!0,o=!1;this.pause=function(){Q.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){Q.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(a){this._input=a,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){o&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):s=!0},this._streamData=q(function(a){try{t.push(typeof a=="string"?a:a.toString(this._config.encoding)),s&&(s=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(g){this._streamError(g)}},this),this._streamError=q(function(a){this._streamCleanUp(),this._sendError(a)},this),this._streamEnd=q(function(){this._streamCleanUp(),o=!0,this._streamData("")},this),this._streamCleanUp=q(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function le(e){var t,s,o,a,g=Math.pow(2,53),P=-g,F=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,i=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,r=this,u=0,l=0,R=!1,d=!1,p=[],c={data:[],errors:[],meta:{}};function D(y){return e.skipEmptyLines==="greedy"?y.join("").trim()==="":y.length===1&&y[0].length===0}function C(){if(c&&o&&(K("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+h.DefaultDelimiter+"'"),o=!1),e.skipEmptyLines&&(c.data=c.data.filter(function(f){return!D(f)})),I()){let f=function(E,N){b(e.transformHeader)&&(E=e.transformHeader(E,N)),p.push(E)};if(c)if(Array.isArray(c.data[0])){for(var y=0;I()&&y<c.data.length;y++)c.data[y].forEach(f);c.data.splice(0,1)}else c.data.forEach(f)}function x(f,E){for(var N=e.header?{}:[],k=0;k<f.length;k++){var w=k,_=f[k],_=((J,m)=>(j=>(e.dynamicTypingFunction&&e.dynamicTyping[j]===void 0&&(e.dynamicTyping[j]=e.dynamicTypingFunction(j)),(e.dynamicTyping[j]||e.dynamicTyping)===!0))(J)?m==="true"||m==="TRUE"||m!=="false"&&m!=="FALSE"&&((j=>{if(F.test(j)&&(j=parseFloat(j),P<j&&j<g))return 1})(m)?parseFloat(m):i.test(m)?new Date(m):m===""?null:m):m)(w=e.header?k>=p.length?"__parsed_extra":p[k]:w,_=e.transform?e.transform(_,w):_);w==="__parsed_extra"?(N[w]=N[w]||[],N[w].push(_)):N[w]=_}return e.header&&(k>p.length?K("FieldMismatch","TooManyFields","Too many fields: expected "+p.length+" fields but parsed "+k,l+E):k<p.length&&K("FieldMismatch","TooFewFields","Too few fields: expected "+p.length+" fields but parsed "+k,l+E)),N}var S;c&&(e.header||e.dynamicTyping||e.transform)&&(S=1,!c.data.length||Array.isArray(c.data[0])?(c.data=c.data.map(x),S=c.data.length):c.data=x(c.data,0),e.header&&c.meta&&(c.meta.fields=p),l+=S)}function I(){return e.header&&p.length===0}function K(y,x,S,f){y={type:y,code:x,message:S},f!==void 0&&(y.row=f),c.errors.push(y)}b(e.step)&&(a=e.step,e.step=function(y){c=y,I()?C():(C(),c.data.length!==0&&(u+=y.data.length,e.preview&&u>e.preview?s.abort():(c.data=c.data[0],a(c,r))))}),this.parse=function(y,x,S){var f=e.quoteChar||'"',f=(e.newline||(e.newline=this.guessLineEndings(y,f)),o=!1,e.delimiter?b(e.delimiter)&&(e.delimiter=e.delimiter(y),c.meta.delimiter=e.delimiter):((f=((E,N,k,w,_)=>{var J,m,j,re;_=_||[",","	","|",";",h.RECORD_SEP,h.UNIT_SEP];for(var ue=0;ue<_.length;ue++){for(var Y,fe=_[ue],L=0,Z=0,A=0,T=(j=void 0,new M({comments:w,delimiter:fe,newline:N,preview:10}).parse(E)),ee=0;ee<T.data.length;ee++)k&&D(T.data[ee])?A++:(Y=T.data[ee].length,Z+=Y,j===void 0?j=Y:0<Y&&(L+=Math.abs(Y-j),j=Y));0<T.data.length&&(Z/=T.data.length-A),(m===void 0||L<=m)&&(re===void 0||re<Z)&&1.99<Z&&(m=L,J=fe,re=Z)}return{successful:!!(e.delimiter=J),bestDelimiter:J}})(y,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=f.bestDelimiter:(o=!0,e.delimiter=h.DefaultDelimiter),c.meta.delimiter=e.delimiter),ce(e));return e.preview&&e.header&&f.preview++,t=y,s=new M(f),c=s.parse(t,x,S),C(),R?{meta:{paused:!0}}:c||{meta:{paused:!1}}},this.paused=function(){return R},this.pause=function(){R=!0,s.abort(),t=b(e.chunk)?"":t.substring(s.getCharIndex())},this.resume=function(){r.streamer._halted?(R=!1,r.streamer.parseChunk(t,!0)):setTimeout(r.resume,3)},this.aborted=function(){return d},this.abort=function(){d=!0,s.abort(),c.meta.aborted=!0,b(e.complete)&&e.complete(c),t=""},this.guessLineEndings=function(E,f){E=E.substring(0,1048576);var f=new RegExp(se(f)+"([^]*?)"+se(f),"gm"),S=(E=E.replace(f,"")).split("\r"),f=E.split(`
`),E=1<f.length&&f[0].length<S[0].length;if(S.length===1||E)return`
`;for(var N=0,k=0;k<S.length;k++)S[k][0]===`
`&&N++;return N>=S.length/2?`\r
`:"\r"}}function se(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function M(e){var t=(e=e||{}).delimiter,s=e.newline,o=e.comments,a=e.step,g=e.preview,P=e.fastMode,F=null,i=!1,r=e.quoteChar==null?'"':e.quoteChar,u=r;if(e.escapeChar!==void 0&&(u=e.escapeChar),(typeof t!="string"||-1<h.BAD_DELIMITERS.indexOf(t))&&(t=","),o===t)throw new Error("Comment character same as delimiter");o===!0?o="#":(typeof o!="string"||-1<h.BAD_DELIMITERS.indexOf(o))&&(o=!1),s!==`
`&&s!=="\r"&&s!==`\r
`&&(s=`
`);var l=0,R=!1;this.parse=function(d,p,c){if(typeof d!="string")throw new Error("Input must be a string");var D=d.length,C=t.length,I=s.length,K=o.length,y=b(a),x=[],S=[],f=[],E=l=0;if(!d)return L();if(P||P!==!1&&d.indexOf(r)===-1){for(var N=d.split(s),k=0;k<N.length;k++){if(f=N[k],l+=f.length,k!==N.length-1)l+=s.length;else if(c)return L();if(!o||f.substring(0,K)!==o){if(y){if(x=[],re(f.split(t)),Z(),R)return L()}else re(f.split(t));if(g&&g<=k)return x=x.slice(0,g),L(!0)}}return L()}for(var w=d.indexOf(t,l),_=d.indexOf(s,l),J=new RegExp(se(u)+se(r),"g"),m=d.indexOf(r,l);;)if(d[l]===r)for(m=l,l++;;){if((m=d.indexOf(r,m+1))===-1)return c||S.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:x.length,index:l}),Y();if(m===D-1)return Y(d.substring(l,m).replace(J,r));if(r===u&&d[m+1]===u)m++;else if(r===u||m===0||d[m-1]!==u){w!==-1&&w<m+1&&(w=d.indexOf(t,m+1));var j=ue((_=_!==-1&&_<m+1?d.indexOf(s,m+1):_)===-1?w:Math.min(w,_));if(d.substr(m+1+j,C)===t){f.push(d.substring(l,m).replace(J,r)),d[l=m+1+j+C]!==r&&(m=d.indexOf(r,l)),w=d.indexOf(t,l),_=d.indexOf(s,l);break}if(j=ue(_),d.substring(m+1+j,m+1+j+I)===s){if(f.push(d.substring(l,m).replace(J,r)),fe(m+1+j+I),w=d.indexOf(t,l),m=d.indexOf(r,l),y&&(Z(),R))return L();if(g&&x.length>=g)return L(!0);break}S.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:x.length,index:l}),m++}}else if(o&&f.length===0&&d.substring(l,l+K)===o){if(_===-1)return L();l=_+I,_=d.indexOf(s,l),w=d.indexOf(t,l)}else if(w!==-1&&(w<_||_===-1))f.push(d.substring(l,w)),l=w+C,w=d.indexOf(t,l);else{if(_===-1)break;if(f.push(d.substring(l,_)),fe(_+I),y&&(Z(),R))return L();if(g&&x.length>=g)return L(!0)}return Y();function re(A){x.push(A),E=l}function ue(A){var T=0;return T=A!==-1&&(A=d.substring(m+1,A))&&A.trim()===""?A.length:T}function Y(A){return c||(A===void 0&&(A=d.substring(l)),f.push(A),l=D,re(f),y&&Z()),L()}function fe(A){l=A,re(f),f=[],_=d.indexOf(s,l)}function L(A){if(e.header&&!p&&x.length&&!i){var T=x[0],ee=Object.create(null),xe=new Set(T);let ve=!1;for(let he=0;he<T.length;he++){let G=T[he];if(ee[G=b(e.transformHeader)?e.transformHeader(G,he):G]){let pe,be=ee[G];for(;pe=G+"_"+be,be++,xe.has(pe););xe.add(pe),T[he]=pe,ee[G]++,ve=!0,(F=F===null?{}:F)[pe]=G}else ee[G]=1,T[he]=G;xe.add(G)}ve&&console.warn("Duplicate headers found and renamed."),i=!0}return{data:x,errors:S,meta:{delimiter:t,linebreak:s,aborted:R,truncated:!!A,cursor:E+(p||0),renamedHeaders:F}}}function Z(){a(L()),x=[],S=[]}},this.abort=function(){R=!0},this.getCharIndex=function(){return l}}function me(e){var t=e.data,s=W[t.workerId],o=!1;if(t.error)s.userError(t.error,t.file);else if(t.results&&t.results.data){var a={abort:function(){o=!0,U(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:de,resume:de};if(b(s.userStep)){for(var g=0;g<t.results.data.length&&(s.userStep({data:t.results.data[g],errors:t.results.errors,meta:t.results.meta},a),!o);g++);delete t.results}else b(s.userChunk)&&(s.userChunk(t.results,a,t.file),delete t.results)}t.finished&&!o&&U(t.workerId,t.results)}function U(e,t){var s=W[e];b(s.userComplete)&&s.userComplete(t),s.terminate(),delete W[e]}function de(){throw new Error("Not implemented.")}function ce(e){if(typeof e!="object"||e===null)return e;var t,s=Array.isArray(e)?[]:{};for(t in e)s[t]=ce(e[t]);return s}function q(e,t){return function(){e.apply(t,arguments)}}function b(e){return typeof e=="function"}return h.parse=function(e,t){var s=(t=t||{}).dynamicTyping||!1;if(b(s)&&(t.dynamicTypingFunction=s,s={}),t.dynamicTyping=s,t.transform=!!b(t.transform)&&t.transform,!t.worker||!h.WORKERS_SUPPORTED)return s=null,h.NODE_STREAM_INPUT,typeof e=="string"?(e=(o=>o.charCodeAt(0)!==65279?o:o.slice(1))(e),s=new(t.download?ne:te)(t)):e.readable===!0&&b(e.read)&&b(e.on)?s=new oe(t):(v.File&&e instanceof File||e instanceof Object)&&(s=new ae(t)),s.stream(e);(s=(()=>{var o;return!!h.WORKERS_SUPPORTED&&(o=(()=>{var a=v.URL||v.webkitURL||null,g=z.toString();return h.BLOB_URL||(h.BLOB_URL=a.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",g,")();"],{type:"text/javascript"})))})(),(o=new v.Worker(o)).onmessage=me,o.id=_e++,W[o.id]=o)})()).userStep=t.step,s.userChunk=t.chunk,s.userComplete=t.complete,s.userError=t.error,t.step=b(t.step),t.chunk=b(t.chunk),t.complete=b(t.complete),t.error=b(t.error),delete t.worker,s.postMessage({input:e,config:t,workerId:s.id})},h.unparse=function(e,t){var s=!1,o=!0,a=",",g=`\r
`,P='"',F=P+P,i=!1,r=null,u=!1,l=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||h.BAD_DELIMITERS.filter(function(p){return t.delimiter.indexOf(p)!==-1}).length||(a=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(s=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(i=t.skipEmptyLines),typeof t.newline=="string"&&(g=t.newline),typeof t.quoteChar=="string"&&(P=t.quoteChar),typeof t.header=="boolean"&&(o=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");r=t.columns}t.escapeChar!==void 0&&(F=t.escapeChar+P),t.escapeFormulae instanceof RegExp?u=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(u=/^[=+\-@\t\r].*$/)}})(),new RegExp(se(P),"g"));if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return R(null,e,i);if(typeof e[0]=="object")return R(r||Object.keys(e[0]),e,i)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||r),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),R(e.fields||[],e.data||[],i);throw new Error("Unable to serialize unrecognized input");function R(p,c,D){var C="",I=(typeof p=="string"&&(p=JSON.parse(p)),typeof c=="string"&&(c=JSON.parse(c)),Array.isArray(p)&&0<p.length),K=!Array.isArray(c[0]);if(I&&o){for(var y=0;y<p.length;y++)0<y&&(C+=a),C+=d(p[y],y);0<c.length&&(C+=g)}for(var x=0;x<c.length;x++){var S=(I?p:c[x]).length,f=!1,E=I?Object.keys(c[x]).length===0:c[x].length===0;if(D&&!I&&(f=D==="greedy"?c[x].join("").trim()==="":c[x].length===1&&c[x][0].length===0),D==="greedy"&&I){for(var N=[],k=0;k<S;k++){var w=K?p[k]:k;N.push(c[x][w])}f=N.join("").trim()===""}if(!f){for(var _=0;_<S;_++){0<_&&!E&&(C+=a);var J=I&&K?p[_]:_;C+=d(c[x][J],_)}x<c.length-1&&(!D||0<S&&!E)&&(C+=g)}}return C}function d(p,c){var D,C;return p==null?"":p.constructor===Date?JSON.stringify(p).slice(1,25):(C=!1,u&&typeof p=="string"&&u.test(p)&&(p="'"+p,C=!0),D=p.toString().replace(l,F),(C=C||s===!0||typeof s=="function"&&s(p,c)||Array.isArray(s)&&s[c]||((I,K)=>{for(var y=0;y<K.length;y++)if(-1<I.indexOf(K[y]))return!0;return!1})(D,h.BAD_DELIMITERS)||-1<D.indexOf(a)||D.charAt(0)===" "||D.charAt(D.length-1)===" ")?P+D+P:D)}},h.RECORD_SEP="",h.UNIT_SEP="",h.BYTE_ORDER_MARK="\uFEFF",h.BAD_DELIMITERS=["\r",`
`,'"',h.BYTE_ORDER_MARK],h.WORKERS_SUPPORTED=!$&&!!v.Worker,h.NODE_STREAM_INPUT=1,h.LocalChunkSize=10485760,h.RemoteChunkSize=5242880,h.DefaultDelimiter=",",h.Parser=M,h.ParserHandle=le,h.NetworkStreamer=ne,h.FileStreamer=ae,h.StringStreamer=te,h.ReadableStreamStreamer=oe,v.jQuery&&((H=v.jQuery).fn.parse=function(e){var t=e.config||{},s=[];return this.each(function(g){if(!(H(this).prop("tagName").toUpperCase()==="INPUT"&&H(this).attr("type").toLowerCase()==="file"&&v.FileReader)||!this.files||this.files.length===0)return!0;for(var P=0;P<this.files.length;P++)s.push({file:this.files[P],inputElem:this,instanceConfig:H.extend({},t)})}),o(),this;function o(){if(s.length===0)b(e.complete)&&e.complete();else{var g,P,F,i,r=s[0];if(b(e.before)){var u=e.before(r.file,r.inputElem);if(typeof u=="object"){if(u.action==="abort")return g="AbortError",P=r.file,F=r.inputElem,i=u.reason,void(b(e.error)&&e.error({name:g},P,F,i));if(u.action==="skip")return void a();typeof u.config=="object"&&(r.instanceConfig=H.extend(r.instanceConfig,u.config))}else if(u==="skip")return void a()}var l=r.instanceConfig.complete;r.instanceConfig.complete=function(R){b(l)&&l(R,r.file,r.inputElem),a()},h.parse(r.file,r.instanceConfig)}}function a(){s.splice(0,1),o()}}),X&&(v.onmessage=function(e){e=e.data,h.WORKER_ID===void 0&&e&&(h.WORKER_ID=e.workerId),typeof e.input=="string"?v.postMessage({workerId:h.WORKER_ID,results:h.parse(e.input,e.config),finished:!0}):(v.File&&e.input instanceof File||e.input instanceof Object)&&(e=h.parse(e.input,e.config))&&v.postMessage({workerId:h.WORKER_ID,results:e,finished:!0})}),(ne.prototype=Object.create(Q.prototype)).constructor=ne,(ae.prototype=Object.create(Q.prototype)).constructor=ae,(te.prototype=Object.create(te.prototype)).constructor=te,(oe.prototype=Object.create(Q.prototype)).constructor=oe,h})})(ge)),ge.exports}var $e=He();const Ke=Ce($e);function Se(O){return new Promise(V=>{Ke.parse(O,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,worker:!0,fastMode:!0,complete:z=>{const v=z.meta.fields??[],H=z.data.slice(0),$=(z.errors??[]).map(X=>({row:X.row??-1,column:X.code,message:X.message}));V({rows:H,headers:v,errors:$})}})})}function ie(O){if(typeof O=="number")return Number.isFinite(O)?O:void 0;if(typeof O=="string"&&O.trim()!==""){const V=Number(O.replace(/[,\s]/g,""));return Number.isFinite(V)?V:void 0}}const Ee=["ProjectID","Date","ActualPhysicalPct"],Pe=["ProjectID","Date","ActualAmount"];function Re({rows:O}){const V=O.length?Object.keys(O[0]):[];return n.jsx("div",{className:"overflow-auto max-h-80 border rounded-lg",children:n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:"sticky top-0 bg-gray-50",children:n.jsx("tr",{children:V.map(z=>n.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-600 border-b",children:z},z))})}),n.jsx("tbody",{children:O.slice(0,50).map((z,v)=>n.jsx("tr",{className:"odd:bg-white even:bg-gray-50",children:V.map(H=>n.jsx("td",{className:"px-3 py-2 border-b whitespace-nowrap",children:String(z[H]??"")},H))},v))})]})})}function Ve(){const O=De(),V=ke(i=>i.setData),z=ke(i=>i.refreshKPIs),[v,H]=B.useState(null),[$,X]=B.useState(null),[W,_e]=B.useState([]),[h,Q]=B.useState([]),[ne,ae]=B.useState([]),[te,oe]=B.useState([]),[le,se]=B.useState(!1),[M,me]=B.useState({ProjectID:"ProjectID",Date:"Date",ActualPhysicalPct:"ActualPhysicalPct"}),[U,de]=B.useState({ProjectID:"ProjectID",Date:"Date",ActualAmount:"ActualAmount"}),ce="highwayexec-mapping-presets",[q,b]=B.useState(()=>{try{const i=localStorage.getItem(ce);if(i)return JSON.parse(i)}catch{}return[{name:"Default (exact headers)",physMap:{ProjectID:"ProjectID",Date:"Date",ActualPhysicalPct:"ActualPhysicalPct"},finMap:{ProjectID:"ProjectID",Date:"Date",ActualAmount:"ActualAmount"}}]}),[e,t]=B.useState(q[0]?.name??"");function s(i){b(i);try{localStorage.setItem(ce,JSON.stringify(i))}catch{}}function o(i){const r=q.find(u=>u.name===i);r&&(me(r.physMap),de(r.finMap))}async function a(){if(!v||!$)return;se(!0);const[i,r]=await Promise.all([Se(v),Se($)]);_e(i.rows),Q(r.rows),ae(i.headers),oe(r.headers),se(!1)}function g(){const i=[];for(const r of Ee)Object.values(M).includes(r)||i.push(`Physical: missing mapping for ${r}`);for(const r of Pe)Object.values(U).includes(r)||i.push(`Financial: missing mapping for ${r}`);return W.slice(0,50).forEach((r,u)=>{const l=r[M.ProjectID],R=r[M.Date],d=r[M.ActualPhysicalPct];l||i.push(`Physical row ${u+1}: ProjectID blank`),R||i.push(`Physical row ${u+1}: Date blank`);const p=ie(d);(p==null||p<0||p>100)&&i.push(`Physical row ${u+1}: ActualPhysicalPct invalid`)}),h.slice(0,50).forEach((r,u)=>{const l=r[U.ProjectID],R=r[U.Date],d=r[U.ActualAmount];l||i.push(`Financial row ${u+1}: ProjectID blank`),R||i.push(`Financial row ${u+1}: Date blank`),ie(d)==null&&i.push(`Financial row ${u+1}: ActualAmount invalid`)}),i}function P(){const i=new Map,r=[];for(const u of W){const l=String(u[M.ProjectID]??"").trim();l&&(i.has(l)||i.set(l,{id:l}),r.push({projectId:l,date:String(u[M.Date]??""),actualPhysicalPct:ie(u[M.ActualPhysicalPct]),plannedPhysicalPct:ie(u.PlannedPhysicalPct)}))}for(const u of h){const l=String(u[U.ProjectID]??"").trim();l&&(i.has(l)||i.set(l,{id:l}),r.push({projectId:l,date:String(u[U.Date]??""),actualAmount:ie(u[U.ActualAmount]),plannedAmount:ie(u.PlannedAmount),cumulativeActual:ie(u.CumulativeActual),cumulativePlanned:ie(u.CumulativePlanned),fundingSource:u.FundingSource?String(u.FundingSource):void 0}))}return{projects:Array.from(i.values()),points:r}}const F=B.useMemo(()=>g(),[M,U,W,h]);return n.jsxs("main",{className:"max-w-6xl mx-auto p-6 md:p-10",children:[n.jsxs("header",{className:"mb-8",children:[n.jsxs("h1",{className:"text-2xl font-semibold flex items-center gap-2",children:[n.jsx(we,{size:20})," Upload & Map Fields"]}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Upload Physical & Financial CSVs, map columns, and validate."})]}),n.jsxs("div",{className:"grid gap-6",children:[n.jsxs("div",{className:"card p-6",children:[n.jsxs("h2",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[n.jsx(we,{size:18})," Step 1-2: Upload CSVs"]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("label",{className:"block",children:[n.jsx("span",{className:"text-sm text-gray-600",children:"PhysicalProgress.csv"}),n.jsx("input",{"aria-label":"Upload physical CSV",type:"file",accept:".csv",className:"mt-1 block w-full",onChange:i=>H(i.target.files?.[0]??null)})]}),n.jsxs("label",{className:"block",children:[n.jsx("span",{className:"text-sm text-gray-600",children:"FinancialProgress.csv"}),n.jsx("input",{"aria-label":"Upload financial CSV",type:"file",accept:".csv",className:"mt-1 block w-full",onChange:i=>X(i.target.files?.[0]??null)})]})]}),n.jsxs("div",{className:"mt-4",children:[n.jsxs("button",{className:"btn-primary mr-2 inline-flex items-center gap-2",onClick:a,disabled:!v||!$||le,children:[n.jsx(Le,{size:16})," ",le?"Parsing…":"Parse & Preview"]}),n.jsxs("button",{className:"inline-flex items-center rounded-lg px-4 py-2 border border-gray-300 hover:bg-gray-50 disabled:opacity-60 gap-2",onClick:a,disabled:!v||!$||le,children:[n.jsx(Ae,{size:16})," Re-Parse"]})]})]}),(W.length>0||h.length>0)&&n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"card p-6",children:[n.jsx("h3",{className:"text-lg font-medium mb-3",children:"Physical Preview (first 50)"}),n.jsx(Re,{rows:W})]}),n.jsxs("div",{className:"card p-6",children:[n.jsx("h3",{className:"text-lg font-medium mb-3",children:"Financial Preview (first 50)"}),n.jsx(Re,{rows:h})]})]}),(ne.length>0||te.length>0)&&n.jsxs("div",{className:"card p-6",children:[n.jsxs("h2",{className:"text-lg font-medium mb-4 flex items-center gap-2",children:[n.jsx(Te,{size:18})," Step 4: Map Columns"]}),n.jsx("div",{className:"mb-4 flex flex-col md:flex-row gap-3 md:items-end",children:n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm text-gray-700",children:"Preset"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("select",{className:"border rounded-lg px-2 py-1",value:e,onChange:i=>{t(i.target.value),o(i.target.value)},children:q.map(i=>n.jsx("option",{value:i.name,children:i.name},i.name))}),n.jsxs("button",{className:"inline-flex items-center rounded-lg px-3 py-1.5 border border-gray-300 hover:bg-gray-50 gap-2",onClick:()=>{const i=prompt("Save current mapping as preset name:");if(!i)return;const u=[...q.filter(l=>l.name!==i),{name:i,physMap:M,finMap:U}];s(u),t(i)},children:[n.jsx(Ue,{size:14})," Save Preset"]})]})]})}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium mb-2",children:"Physical Required Fields"}),Ee.map(i=>n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("label",{className:"w-40 text-sm text-gray-700",children:String(i)}),n.jsxs("select",{className:"border rounded-lg px-2 py-1 flex-1",value:M[i]??"",onChange:r=>me(u=>({...u,[i]:r.target.value})),children:[n.jsx("option",{value:"",children:"—"}),ne.map(r=>n.jsx("option",{value:r,children:r},r))]})]},i))]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium mb-2",children:"Financial Required Fields"}),Pe.map(i=>n.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[n.jsx("label",{className:"w-40 text-sm text-gray-700",children:String(i)}),n.jsxs("select",{className:"border rounded-lg px-2 py-1 flex-1",value:U[i]??"",onChange:r=>de(u=>({...u,[i]:r.target.value})),children:[n.jsx("option",{value:"",children:"—"}),te.map(r=>n.jsx("option",{value:r,children:r},r))]})]},i))]})]})]}),n.jsxs("div",{className:"card p-6",children:[n.jsxs("h2",{className:"text-lg font-medium mb-3 flex items-center gap-2",children:[n.jsx(Oe,{size:18})," Validation"]}),F.length===0?n.jsx("div",{className:"text-green-700",children:"No blocking issues detected. You can proceed."}):n.jsx("ul",{className:"list-disc pl-6 text-red-700",children:F.map((i,r)=>n.jsx("li",{children:i},r))})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("button",{className:"btn-primary disabled:opacity-60",disabled:F.length>0||W.length===0||h.length===0,onClick:async()=>{const{projects:i,points:r}=P();V(i,r),await z(),O("/dashboard")},children:"Proceed to Dashboard"}),n.jsx(Ne,{to:"/",className:"inline-flex items-center rounded-lg px-4 py-2 border border-gray-300 hover:bg-gray-50",children:"Back"})]})]})]})}export{Ve as default};
